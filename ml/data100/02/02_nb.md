
## 第2章 小売店のデータでデータ加工を行う10本ノック

第２章では小売店の売り上げデータの解析、予測になります。汚いデータをいかに加工して予測のモデルを構築をして行くかという演習になっています。

こういう実務的な問題を演習として用意してくれているので、とてもありがたいです。

結果だけ載せました。正解かどうかは保障しません笑

### github
- jupyter notebook形式のファイルは[こちら](https://github.com/hiroshi0530/wa-src/blob/master/ml/data100/02/02_nb.ipynb)

### google colaboratory
- google colaboratory で実行する場合は[こちら](https://colab.research.google.com/github/hiroshi0530/wa-src/blob/master/ml/data100/02/02_nb.ipynb)

### 筆者の環境


```python
!sw_vers
```

    ProductName:	Mac OS X
    ProductVersion:	10.14.6
    BuildVersion:	18G6020



```python
!python -V
```

    Python 3.7.3


基本的なライブラリをインポートしそのバージョンを確認しておきます。


```python
%matplotlib inline
%config InlineBackend.figure_format = 'svg'

import matplotlib
import matplotlib.pyplot as plt
import scipy
import numpy as np
import pandas as pd

print('matplotlib version :', matplotlib.__version__)
print('scipy version :', scipy.__version__)
print('numpy version :', np.__version__)
print('pandas version :', pd.__version__)
```

    matplotlib version : 3.0.3
    scipy version : 1.4.1
    numpy version : 1.16.2
    pandas version : 1.0.3


## 解答

### ノック11 : データを読み込んでみよう


```python
uriage_data = pd.read_csv('uriage.csv')
uriage_data.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>purchase_date</th>
      <th>item_name</th>
      <th>item_price</th>
      <th>customer_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-06-13 18:02:34</td>
      <td>商品A</td>
      <td>100.0</td>
      <td>深井菜々美</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-07-13 13:05:29</td>
      <td>商 品 S</td>
      <td>NaN</td>
      <td>浅田賢二</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-05-11 19:42:07</td>
      <td>商 品 a</td>
      <td>NaN</td>
      <td>南部慶二</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-02-12 23:40:45</td>
      <td>商品Z</td>
      <td>2600.0</td>
      <td>麻生莉緒</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-04-22 03:09:35</td>
      <td>商品a</td>
      <td>NaN</td>
      <td>平田鉄二</td>
    </tr>
  </tbody>
</table>
</div>



途中で半角スペースが入っていたり、大文字、小文字の差異などいい感じに表記が揺れています。一応カラム名を確認しておきます。


```python
uriage_data.columns
```




    Index(['purchase_date', 'item_name', 'item_price', 'customer_name',
           'purchase_month'],
          dtype='object')




```python
kokyaku_data = pd.read_excel('kokyaku_daicho.xlsx')
kokyaku_data.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>顧客名</th>
      <th>かな</th>
      <th>地域</th>
      <th>メールアドレス</th>
      <th>登録日</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>須賀ひとみ</td>
      <td>すが ひとみ</td>
      <td>H市</td>
      <td>suga_hitomi@example.com</td>
      <td>2018/01/04</td>
    </tr>
    <tr>
      <th>1</th>
      <td>岡田　 敏也</td>
      <td>おかだ としや</td>
      <td>E市</td>
      <td>okada_toshiya@example.com</td>
      <td>42782</td>
    </tr>
    <tr>
      <th>2</th>
      <td>芳賀 希</td>
      <td>はが のぞみ</td>
      <td>A市</td>
      <td>haga_nozomi@example.com</td>
      <td>2018/01/07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>荻野  愛</td>
      <td>おぎの あい</td>
      <td>F市</td>
      <td>ogino_ai@example.com</td>
      <td>42872</td>
    </tr>
    <tr>
      <th>4</th>
      <td>栗田 憲一</td>
      <td>くりた けんいち</td>
      <td>E市</td>
      <td>kurita_kenichi@example.com</td>
      <td>43127</td>
    </tr>
  </tbody>
</table>
</div>




```python
kokyaku_data.columns
```




    Index(['顧客名', 'かな', '地域', 'メールアドレス', '登録日'], dtype='object')



### ノック12 : データの揺れを見てみよう


```python
uriage_data['item_name'].head()
```




    0      商品A
    1    商 品 S
    2    商 品 a
    3      商品Z
    4      商品a
    Name: item_name, dtype: object




```python
uriage_data['item_price'].head()
```




    0     100.0
    1       NaN
    2       NaN
    3    2600.0
    4       NaN
    Name: item_price, dtype: float64



かなりデータが揺れがあるのがわかります。

### ノック13 : データに揺れがあるまま集計してみよう 

日付がobject型なのでdatetime型に変換します。


```python
uriage_data['purchase_date'] = pd.to_datetime(uriage_data['purchase_date'])
```


```python
uriage_data[['purchase_date']].head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>purchase_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-06-13 18:02:34</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-07-13 13:05:29</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-05-11 19:42:07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-02-12 23:40:45</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-04-22 03:09:35</td>
    </tr>
  </tbody>
</table>
</div>



daetime型に変換されています。

月ごとの集計値を計算します。


```python
uriage_data['purchase_month'] = uriage_data['purchase_date'].dt.strftime('%Y%m')
res = uriage_data.pivot_table(index='purchase_month', columns='item_name', aggfunc='size', fill_value=0)
res
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>item_name</th>
      <th>商品W</th>
      <th>商 品 n</th>
      <th>商品E</th>
      <th>商品M</th>
      <th>商品P</th>
      <th>商品S</th>
      <th>商品W</th>
      <th>商品X</th>
      <th>商  品O</th>
      <th>商  品Q</th>
      <th>...</th>
      <th>商品k</th>
      <th>商品l</th>
      <th>商品o</th>
      <th>商品p</th>
      <th>商品r</th>
      <th>商品s</th>
      <th>商品t</th>
      <th>商品v</th>
      <th>商品x</th>
      <th>商品y</th>
    </tr>
    <tr>
      <th>purchase_month</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>201901</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201902</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201903</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201904</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201905</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>201906</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201907</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>7 rows × 99 columns</p>
</div>




```python
res.shape
```




    (7, 99)



商品数が99個になっています。
次に価格の集計についても見てみます。


```python
res = uriage_data.pivot_table(index='purchase_month', columns='item_name', values='item_price', aggfunc='sum', fill_value=0)
res
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>item_name</th>
      <th>商品W</th>
      <th>商 品 n</th>
      <th>商品E</th>
      <th>商品M</th>
      <th>商品P</th>
      <th>商品S</th>
      <th>商品W</th>
      <th>商品X</th>
      <th>商  品O</th>
      <th>商  品Q</th>
      <th>...</th>
      <th>商品k</th>
      <th>商品l</th>
      <th>商品o</th>
      <th>商品p</th>
      <th>商品r</th>
      <th>商品s</th>
      <th>商品t</th>
      <th>商品v</th>
      <th>商品x</th>
      <th>商品y</th>
    </tr>
    <tr>
      <th>purchase_month</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>201901</th>
      <td>0</td>
      <td>1400</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1100</td>
      <td>1200</td>
      <td>1500</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201902</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2400</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1900</td>
      <td>2000</td>
      <td>2200</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201903</th>
      <td>0</td>
      <td>0</td>
      <td>500</td>
      <td>1300</td>
      <td>1600</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201904</th>
      <td>2300</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1700</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1900</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201905</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1900</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1200</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2500</td>
    </tr>
    <tr>
      <th>201906</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2300</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1600</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2400</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201907</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1500</td>
      <td>0</td>
      <td>1800</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>7 rows × 99 columns</p>
</div>



こちらも全く意味をなしてないことがわかります。

### ノック14 : 

まずは商品名の揺れを補正していくようです。今回抽出された商品の一覧です。


```python
pd.unique(uriage_data['item_name'])
```




    array(['商品A', '商 品 S', '商 品 a', '商品Z', '商品a', '商品S', '商品 a', '商品V', '商品O',
           '商 品U', '商品L', '商  品V', '商 品O', '商品C', '商品I', '商品r', '商品X', '商品 g',
           '商品R', '商品P', '商品Q', '商品y', '商品 A', '商品N', '商品W', '商 品E', '商品K',
           '商品B', '商品F', '商 品s', '  商品W', ' 商 品 n', '商 品F', '商品D', '商品M',
           '商品Y', '商品U', '商品H', '商品T', '商品J', '商  品O', '商品E', '商  品Q', ' 商品S',
           ' 商品M', '商  品T', '商品G', '商 品G', ' 商品P', ' 商品E', '商 品N', '商 品Y',
           '商品 J', '商品 V', '商品 K', '商 品V', '商 品D', '商 品A', '商品 F', '商品 H',
           '商 品K', '商 品T', '商品 X', '商品 Q', '商 品X', '商 品H', '商 品C', '商品 B',
           '商品 O', '商品 T', '商品v', '商品p', '商品i', '商品 w', '商 品 s', '商 品 q',
           '商品s', '商品l', '商品t', '商品k', '商品g', '商品o', '商品 R', '商品 S', '商 品M',
           '商品j', '商品d', '商品 I', '商品 E', '商品 o', '商品c', '商品 v', '商品e', '商品x',
           '商 品I', ' 商品W', ' 商品X', '商品 M', '商 品P'], dtype=object)



商品数は９９個です。


```python
len(pd.unique(uriage_data['item_name']))
```




    99



スペースの有無、半角全角統一をします。文字列を扱うメソッド`str`を利用します。


```python
uriage_data['item_name'] = uriage_data['item_name'].str.upper()
uriage_data['item_name'] = uriage_data['item_name'].str.replace("　","")
uriage_data['item_name'] = uriage_data['item_name'].str.replace(" ","")
uriage_data.sort_values(by=['item_name'], ascending=True).head(3)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>purchase_date</th>
      <th>item_name</th>
      <th>item_price</th>
      <th>customer_name</th>
      <th>purchase_month</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-06-13 18:02:34</td>
      <td>商品A</td>
      <td>100.0</td>
      <td>深井菜々美</td>
      <td>201906</td>
    </tr>
    <tr>
      <th>1748</th>
      <td>2019-05-19 20:22:22</td>
      <td>商品A</td>
      <td>100.0</td>
      <td>松川綾女</td>
      <td>201905</td>
    </tr>
    <tr>
      <th>223</th>
      <td>2019-06-25 08:13:20</td>
      <td>商品A</td>
      <td>100.0</td>
      <td>板橋隆</td>
      <td>201906</td>
    </tr>
  </tbody>
</table>
</div>




```python
uriage_data['item_name'].unique()
```




    array(['商品A', '商品S', '商品Z', '商品V', '商品O', '商品U', '商品L', '商品C', '商品I',
           '商品R', '商品X', '商品G', '商品P', '商品Q', '商品Y', '商品N', '商品W', '商品E',
           '商品K', '商品B', '商品F', '商品D', '商品M', '商品H', '商品T', '商品J'],
          dtype=object)




```python
len(uriage_data['item_name'].unique())
```




    26



となり、商品名の揺れは解消されました。

### ノック15 :  金額欠損値の補完をしよう

金額にどれぐらいの欠損値（Null)があるか確認しています。


```python
uriage_data.isnull().sum()
```




    purchase_date       0
    item_name           0
    item_price        387
    customer_name       0
    purchase_month      0
    dtype: int64




```python
uriage_data.shape
```




    (2999, 5)



行数が2999で、387行が欠損値で約１２％が欠落していることになります。

教科書では、


```python
uriage_data.isnull().any(axis=0)
```




    purchase_date     False
    item_name         False
    item_price         True
    customer_name     False
    purchase_month    False
    dtype: bool



とデータの欠損の有無を確認しています。


```python
uriage_data.isnull().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>purchase_date</th>
      <th>item_name</th>
      <th>item_price</th>
      <th>customer_name</th>
      <th>purchase_month</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>



anyメソッド、引数のオプションにaxisを指定することで、一つでもNullがあればTrueを返し、Nullの有無を確認出来ます。


```python
uriage_data.isnull().any(axis=0)
```




    purchase_date     False
    item_name         False
    item_price         True
    customer_name     False
    purchase_month    False
    dtype: bool




```python

```


```python
flg_is_null = uriage_data['item_price'].isnull()
```




    array(['商品S', '商品A', '商品P', '商品N', '商品W', '商品R', '商品I', '商品L', '商品F',
           '商品O', '商品B', '商品C', '商品V', '商品Q', '商品U', '商品K', '商品T', '商品X',
           '商品E', '商品M', '商品G', '商品J', '商品D', '商品H', '商品Y'], dtype=object)




```python
uriage_data.loc[flg_is_null, 'item_name'].unique()
```




    array(['商品S', '商品A', '商品P', '商品N', '商品W', '商品R', '商品I', '商品L', '商品F',
           '商品O', '商品B', '商品C', '商品V', '商品Q', '商品U', '商品K', '商品T', '商品X',
           '商品E', '商品M', '商品G', '商品J', '商品D', '商品H', '商品Y'], dtype=object)




```python
flg_is_null = uriage_data['item_price'].isnull()

for trg in list(uriage_data.loc[flg_is_null, 'item_name'].unique()):
  price = uriage_data.loc[(~flg_is_null) & (uriage_data['item_name'] == trg), 'item_price'].max()
  uriage_data['item_price'].loc[(flg_is_null) & (uriage_data['item_name'] == trg)] = price
  
uriage_data.head()
```

    /Users/hiroshi/anaconda3/lib/python3.7/site-packages/pandas/core/indexing.py:671: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      self._setitem_with_indexer(indexer, value)





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>purchase_date</th>
      <th>item_name</th>
      <th>item_price</th>
      <th>customer_name</th>
      <th>purchase_month</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-06-13 18:02:34</td>
      <td>商品A</td>
      <td>100.0</td>
      <td>深井菜々美</td>
      <td>201906</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-07-13 13:05:29</td>
      <td>商品S</td>
      <td>1900.0</td>
      <td>浅田賢二</td>
      <td>201907</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-05-11 19:42:07</td>
      <td>商品A</td>
      <td>100.0</td>
      <td>南部慶二</td>
      <td>201905</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-02-12 23:40:45</td>
      <td>商品Z</td>
      <td>2600.0</td>
      <td>麻生莉緒</td>
      <td>201902</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-04-22 03:09:35</td>
      <td>商品A</td>
      <td>100.0</td>
      <td>平田鉄二</td>
      <td>201904</td>
    </tr>
  </tbody>
</table>
</div>




```python
uriage_data['item_price'].isnull().any(axis=0)
uriage_data.isnull().any(axis=0)
```




    purchase_date     False
    item_name         False
    item_price        False
    customer_name     False
    purchase_month    False
    dtype: bool




```python

```

### ノック16 : 顧客名の揺れを補正しよう

次は文字列の揺れの修正になります。


```python
kokyaku_data['顧客名'].head()
```




    0     須賀ひとみ
    1    岡田　 敏也
    2      芳賀 希
    3     荻野  愛
    4     栗田 憲一
    Name: 顧客名, dtype: object



こちらもスペースが有無に違いがある事尾がわかります。


```python
uriage_data['customer_name'].head()
```




    0    深井菜々美
    1     浅田賢二
    2     南部慶二
    3     麻生莉緒
    4     平田鉄二
    Name: customer_name, dtype: object



こちらはスペースがありません。こういった名前の表式の差異は、名前が一意キーとなっている場合ｌ、ジョインできないなどの大きいな問題になります。

こちらは、スペースを削除する方向でデータの補正を行います。


```python
kokyaku_data['顧客名'] = kokyaku_data['顧客名'].str.replace(" ","")
kokyaku_data['顧客名'] = kokyaku_data['顧客名'].str.replace("　","")
kokyaku_data['顧客名'].head()
```




    0    須賀ひとみ
    1     岡田敏也
    2      芳賀希
    3      荻野愛
    4     栗田憲一
    Name: 顧客名, dtype: object



事務レベルでは名前の補正は本当にやっかいです。このほかにも、同姓同名の処理や、漢字が同じなのに読み方が異なる場合など、大変です。

### ノック17 : 日付の揺れを補正しよう

次に日付の揺れを補正します。教科書の場合は、日付の表記が異なっていたり、エクセルの設定により日付が数字になっていたりするので、それを補正します。

まずは数値として取り込まれているデータを取得します。


```python
flg_is_series = kokyaku_data['登録日'].astype('str').str.isdigit()

flg_is_series.sum()
```




    22




```python

```

### ノック18 : 顧客名をキーに二つのデータを結合しよう


```python

```

### ノック19 : クレンジングしたデータをダンプしよう


```python

```

### ノック20 : データを集計しよう


```python

```

## 関連記事
- [第1章 ウェブからの注文数を分析する10本ノック](/ml/data100/01/)
- [第2章 小売店のデータでデータ加工を行う10本ノック](/ml/data100/02/)
- [第3章 顧客の全体像を把握する10本ノック](/ml/data100/03/)
- [第4章 顧客の行動を予測する10本ノック](/ml/data100/04/)
- [第5章 顧客の退会を予測する10本ノック](/ml/data100/05/)
- [第6章 物流の最適ルートをコンサルティングする10本ノック](/ml/data100/06/)
- [第7章 ロジスティクスネットワークの最適設計を行う10本ノック](/ml/data100/07/)
- [第8章 数値シミュレーションで消費者行動を予測する10本ノック](/ml/data100/08/)
- [第9章 潜在顧客を把握するための画像認識10本ノック](/ml/data100/09/)
- [第10章 アンケート分析を行うための自然言語処理10本ノック](/ml/data100/10/)
