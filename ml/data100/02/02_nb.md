
## 第2章 小売店のデータでデータ加工を行う10本ノック
結果だけ載せました。正解かどうかは保障しません笑

### github
- githubのjupyter notebook形式のファイルは[こちら](https://github.com/hiroshi0530/wa/blob/master/src/ml/data100/01/01_nb.ipynb)

### 筆者の環境


```python
!sw_vers
```

    ProductName:	Mac OS X
    ProductVersion:	10.14.6
    BuildVersion:	18G2022



```python
!python -V
```

    Python 3.7.3



```python
import pandas as pd

pd.__version__
```




    '1.0.3'




```python
import matplotlib

matplotlib.__version__
```




    '3.0.3'



matplotlibを呼び込み、保存する画像をsvgに設定します。


```python
import matplotlib.pyplot as plt
%matplotlib inline
%config InlineBackend.figure_format = 'svg'
```

## 解答

### ノック11 : データを読み込んでみよう


```python
uriage_data = pd.read_csv('uriage.csv')
uriage_data.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>purchase_date</th>
      <th>item_name</th>
      <th>item_price</th>
      <th>customer_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-06-13 18:02:34</td>
      <td>商品A</td>
      <td>100.0</td>
      <td>深井菜々美</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-07-13 13:05:29</td>
      <td>商 品 S</td>
      <td>NaN</td>
      <td>浅田賢二</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-05-11 19:42:07</td>
      <td>商 品 a</td>
      <td>NaN</td>
      <td>南部慶二</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-02-12 23:40:45</td>
      <td>商品Z</td>
      <td>2600.0</td>
      <td>麻生莉緒</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-04-22 03:09:35</td>
      <td>商品a</td>
      <td>NaN</td>
      <td>平田鉄二</td>
    </tr>
  </tbody>
</table>
</div>




```python
kokyaku_data = pd.read_excel('kokyaku_daicho.xlsx')
kokyaku_data.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>顧客名</th>
      <th>かな</th>
      <th>地域</th>
      <th>メールアドレス</th>
      <th>登録日</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>須賀ひとみ</td>
      <td>すが ひとみ</td>
      <td>H市</td>
      <td>suga_hitomi@example.com</td>
      <td>2018/01/04</td>
    </tr>
    <tr>
      <th>1</th>
      <td>岡田　 敏也</td>
      <td>おかだ としや</td>
      <td>E市</td>
      <td>okada_toshiya@example.com</td>
      <td>42782</td>
    </tr>
    <tr>
      <th>2</th>
      <td>芳賀 希</td>
      <td>はが のぞみ</td>
      <td>A市</td>
      <td>haga_nozomi@example.com</td>
      <td>2018/01/07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>荻野  愛</td>
      <td>おぎの あい</td>
      <td>F市</td>
      <td>ogino_ai@example.com</td>
      <td>42872</td>
    </tr>
    <tr>
      <th>4</th>
      <td>栗田 憲一</td>
      <td>くりた けんいち</td>
      <td>E市</td>
      <td>kurita_kenichi@example.com</td>
      <td>43127</td>
    </tr>
  </tbody>
</table>
</div>



### ノック12 : データの揺れを見てみよう


```python
uriage_data['item_name'].head()
```




    0      商品A
    1    商 品 S
    2    商 品 a
    3      商品Z
    4      商品a
    Name: item_name, dtype: object




```python
uriage_data['item_price'].head()
```




    0     100.0
    1       NaN
    2       NaN
    3    2600.0
    4       NaN
    Name: item_price, dtype: float64



かなりデータが揺れがあるのがわかります。

### ノック13 : データに揺れがあるまま集計してみよう 


```python
uriage_data['purchase_date'] = pd.to_datetime(uriage_data['purchase_date'])
```


```python
uriage_data['purchase_date']
```




    0      2019-06-13 18:02:34
    1      2019-07-13 13:05:29
    2      2019-05-11 19:42:07
    3      2019-02-12 23:40:45
    4      2019-04-22 03:09:35
                   ...        
    2994   2019-02-15 02:56:39
    2995   2019-06-22 04:03:43
    2996   2019-03-29 11:14:05
    2997   2019-07-14 12:56:49
    2998   2019-07-21 00:31:36
    Name: purchase_date, Length: 2999, dtype: datetime64[ns]



datetime型に変換されています。


```python
uriage_data['purchase_month'] = uriage_data['purchase_date'].dt.strftime('%Y%m')
res = uriage_data.pivot_table(index='purchase_month', columns='item_name', aggfunc='size', fill_value=0)
res
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>item_name</th>
      <th>商品W</th>
      <th>商 品 n</th>
      <th>商品E</th>
      <th>商品M</th>
      <th>商品P</th>
      <th>商品S</th>
      <th>商品W</th>
      <th>商品X</th>
      <th>商  品O</th>
      <th>商  品Q</th>
      <th>...</th>
      <th>商品k</th>
      <th>商品l</th>
      <th>商品o</th>
      <th>商品p</th>
      <th>商品r</th>
      <th>商品s</th>
      <th>商品t</th>
      <th>商品v</th>
      <th>商品x</th>
      <th>商品y</th>
    </tr>
    <tr>
      <th>purchase_month</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>201901</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201902</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201903</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201904</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201905</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>201906</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201907</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>7 rows × 99 columns</p>
</div>




```python
res.shape
```




    (7, 99)



商品数が99個になっています。
次に価格についても見てみます。


```python
res = uriage_data.pivot_table(index='purchase_month', columns='item_name', values='item_price', aggfunc='sum', fill_value=0)
res
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>item_name</th>
      <th>商品W</th>
      <th>商 品 n</th>
      <th>商品E</th>
      <th>商品M</th>
      <th>商品P</th>
      <th>商品S</th>
      <th>商品W</th>
      <th>商品X</th>
      <th>商  品O</th>
      <th>商  品Q</th>
      <th>...</th>
      <th>商品k</th>
      <th>商品l</th>
      <th>商品o</th>
      <th>商品p</th>
      <th>商品r</th>
      <th>商品s</th>
      <th>商品t</th>
      <th>商品v</th>
      <th>商品x</th>
      <th>商品y</th>
    </tr>
    <tr>
      <th>purchase_month</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>201901</th>
      <td>0</td>
      <td>1400</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1100</td>
      <td>1200</td>
      <td>1500</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201902</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2400</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1900</td>
      <td>2000</td>
      <td>2200</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201903</th>
      <td>0</td>
      <td>0</td>
      <td>500</td>
      <td>1300</td>
      <td>1600</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201904</th>
      <td>2300</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1700</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1900</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201905</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1900</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1200</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2500</td>
    </tr>
    <tr>
      <th>201906</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2300</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1600</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2400</td>
      <td>0</td>
    </tr>
    <tr>
      <th>201907</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1500</td>
      <td>0</td>
      <td>1800</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>7 rows × 99 columns</p>
</div>



### ノック14 : 


```python

```

### ノック15 : 


```python

```

### ノック16 : 


```python

```

### ノック17 : 


```python

```

### ノック18 : 


```python

```

### ノック19 : 


```python

```

### ノック20 : 


```python

```

## 関連記事
- [第1章 ウェブからの注文数を分析する10本ノック](/ml/data100/01/)
- [第2章 小売店のデータでデータ加工を行う10本ノック](/ml/data100/02/)
- [第3章 顧客の全体像を把握する10本ノック](/ml/data100/03/)
- [第4章 顧客の行動を予測する10本ノック](/ml/data100/04/)
- [第5章 顧客の退会を予測する10本ノック](/ml/data100/05/)
- [第6章 物流の最適ルートをコンサルティングする10本ノック](/ml/data100/06/)
- [第7章 ロジスティクスネットワークの最適設計を行う10本ノック](/ml/data100/07/)
- [第8章 数値シミュレーションで消費者行動を予測する10本ノック](/ml/data100/08/)
- [第9章 潜在顧客を把握するための画像認識10本ノック](/ml/data100/09/)
- [第10章 アンケート分析を行うための自然言語処理10本ノック](/ml/data100/10/)
