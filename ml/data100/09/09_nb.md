
## 第9章 潜在顧客を把握するための画像処理10本ノック

この記事は[「Python実践データ分析100本ノック」](https://www.amazon.co.jp/dp/B07ZSGSN9S/ref=dp-kindle-redirect?_encoding=UTF8&btkr=1)の演習を実際にやってみたという内容になっています。今まで自己流でやってきましたが、一度他の方々がどのような考え方やコーディングをしているのか勉強してみようと思ってやってみました。本書は実際の業務に活用する上でとても参考になる内容だと思っています。データ分析に関わる仕事をしたい方にお勧めしたいです。

私は画像やテキストの処理は割と経験あるので、前章のネットワークの可視化などよりかなりスムーズに演習することが出来ました。

### github
- jupyter notebook形式のファイルは[こちら](https://github.com/hiroshi0530/wa-src/blob/master/ml/data100/09/09_nb.ipynb)

### google colaboratory
- google colaboratory で実行する場合は[こちら](https://colab.research.google.com/github/hiroshi0530/wa-src/blob/master/ml/data100/09/09_nb.ipynb)

### 筆者の環境


```python
!sw_vers
```

    ProductName:	Mac OS X
    ProductVersion:	10.14.6
    BuildVersion:	18G6020



```python
!python -V
```

    Python 3.7.3


基本的なライブラリをインポートしそのバージョンを確認しておきます。


```python
%matplotlib inline
%config InlineBackend.figure_format = 'svg'

import matplotlib
import matplotlib.pyplot as plt
import scipy
import numpy as np
import pandas as pd

print('matplotlib version :', matplotlib.__version__)
print('scipy version :', scipy.__version__)
print('numpy version :', np.__version__)
print('pandas version :', pd.__version__)
```

    matplotlib version : 3.0.3
    scipy version : 1.4.1
    numpy version : 1.16.2
    pandas version : 1.0.3


## 解答

### ノック 81 : 画像データを読み込んでみよう 


```python
import cv2
import os

img = cv2.imread('img/img01.jpg')

if os.path.isfile('img/img01.jpg'):
  height, width = img.shape[:2]

print('画像幅 : ', width)
print('画像の高さ : ', height)

#画像の表示
plt.imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))
plt.show()
```

    画像幅 :  1920
    画像の高さ :  1440



![svg](09_nb_files/09_nb_7_1.svg)


### ノック 82 : 映像データを読み込んでみよう

映像の取得のため、VideoCapture関数を利用します。取得した映像情報をcapに格納し、getにより情報を取得します。フレーム毎の情報をreadメソッドで読み出します。これにより動画情報を画像情報と同様に操作し、imshowメソッドで表示可能です。


```python
cap = cv2.VideoCapture('mov/mov01.avi')
width = cap.get(cv2.CAP_PROP_FRAME_WIDTH)
height = cap.get(cv2.CAP_PROP_FRAME_HEIGHT)
count = cap.get(cv2.CAP_PROP_FRAME_COUNT)
fps = cap.get(cv2.CAP_PROP_FPS)

while(cap.isOpened()):
  ret, frame = cap.read()
  if ret:
    cv2.imshow('frame', frame)
  if cv2.waitKey(1) & 0xFF == ord('q'):
    break

cap.release()
cv2.destroyAllWindows()
```

### ノック 83 : 映像を画像に分割し、保存してみよう

スナップショットとして画像として保存します。


```python
cap = cv2.VideoCapture('mov/mov01.avi')

num = 0
while(cap.isOpened()):
  ret, frame = cap.read()
  if ret:
    filepath = 'snapshot/snapshot_' + str(num) + '.jpg'
    cv2.imwrite(filepath, frame) 
    num += 1
  if cv2.waitKey(1) & 0xFF == ord('q'):
    break
  
cap.release()
cv2.destroyAllWindows()
```


```python
!ls snapshot/
```

    snapshot_0.jpg   snapshot_159.jpg snapshot_219.jpg snapshot_28.jpg  snapshot_34.jpg  snapshot_40.jpg
    snapshot_1.jpg   snapshot_16.jpg  snapshot_22.jpg  snapshot_280.jpg snapshot_340.jpg snapshot_400.jpg
    snapshot_10.jpg  snapshot_160.jpg snapshot_220.jpg snapshot_281.jpg snapshot_341.jpg snapshot_41.jpg
    snapshot_100.jpg snapshot_161.jpg snapshot_221.jpg snapshot_282.jpg snapshot_342.jpg snapshot_42.jpg
    snapshot_101.jpg snapshot_162.jpg snapshot_222.jpg snapshot_283.jpg snapshot_343.jpg snapshot_43.jpg
    snapshot_102.jpg snapshot_163.jpg snapshot_223.jpg snapshot_284.jpg snapshot_344.jpg snapshot_44.jpg
    snapshot_103.jpg snapshot_164.jpg snapshot_224.jpg snapshot_285.jpg snapshot_345.jpg snapshot_45.jpg
    snapshot_104.jpg snapshot_165.jpg snapshot_225.jpg snapshot_286.jpg snapshot_346.jpg snapshot_46.jpg
    snapshot_105.jpg snapshot_166.jpg snapshot_226.jpg snapshot_287.jpg snapshot_347.jpg snapshot_47.jpg
    snapshot_106.jpg snapshot_167.jpg snapshot_227.jpg snapshot_288.jpg snapshot_348.jpg snapshot_48.jpg
    snapshot_107.jpg snapshot_168.jpg snapshot_228.jpg snapshot_289.jpg snapshot_349.jpg snapshot_49.jpg
    snapshot_108.jpg snapshot_169.jpg snapshot_229.jpg snapshot_29.jpg  snapshot_35.jpg  snapshot_5.jpg
    snapshot_109.jpg snapshot_17.jpg  snapshot_23.jpg  snapshot_290.jpg snapshot_350.jpg snapshot_50.jpg
    snapshot_11.jpg  snapshot_170.jpg snapshot_230.jpg snapshot_291.jpg snapshot_351.jpg snapshot_51.jpg
    snapshot_110.jpg snapshot_171.jpg snapshot_231.jpg snapshot_292.jpg snapshot_352.jpg snapshot_52.jpg
    snapshot_111.jpg snapshot_172.jpg snapshot_232.jpg snapshot_293.jpg snapshot_353.jpg snapshot_53.jpg
    snapshot_112.jpg snapshot_173.jpg snapshot_233.jpg snapshot_294.jpg snapshot_354.jpg snapshot_54.jpg
    snapshot_113.jpg snapshot_174.jpg snapshot_234.jpg snapshot_295.jpg snapshot_355.jpg snapshot_55.jpg
    snapshot_114.jpg snapshot_175.jpg snapshot_235.jpg snapshot_296.jpg snapshot_356.jpg snapshot_56.jpg
    snapshot_115.jpg snapshot_176.jpg snapshot_236.jpg snapshot_297.jpg snapshot_357.jpg snapshot_57.jpg
    snapshot_116.jpg snapshot_177.jpg snapshot_237.jpg snapshot_298.jpg snapshot_358.jpg snapshot_58.jpg
    snapshot_117.jpg snapshot_178.jpg snapshot_238.jpg snapshot_299.jpg snapshot_359.jpg snapshot_59.jpg
    snapshot_118.jpg snapshot_179.jpg snapshot_239.jpg snapshot_3.jpg   snapshot_36.jpg  snapshot_6.jpg
    snapshot_119.jpg snapshot_18.jpg  snapshot_24.jpg  snapshot_30.jpg  snapshot_360.jpg snapshot_60.jpg
    snapshot_12.jpg  snapshot_180.jpg snapshot_240.jpg snapshot_300.jpg snapshot_361.jpg snapshot_61.jpg
    snapshot_120.jpg snapshot_181.jpg snapshot_241.jpg snapshot_301.jpg snapshot_362.jpg snapshot_62.jpg
    snapshot_121.jpg snapshot_182.jpg snapshot_242.jpg snapshot_302.jpg snapshot_363.jpg snapshot_63.jpg
    snapshot_122.jpg snapshot_183.jpg snapshot_243.jpg snapshot_303.jpg snapshot_364.jpg snapshot_64.jpg
    snapshot_123.jpg snapshot_184.jpg snapshot_244.jpg snapshot_304.jpg snapshot_365.jpg snapshot_65.jpg
    snapshot_124.jpg snapshot_185.jpg snapshot_245.jpg snapshot_305.jpg snapshot_366.jpg snapshot_66.jpg
    snapshot_125.jpg snapshot_186.jpg snapshot_246.jpg snapshot_306.jpg snapshot_367.jpg snapshot_67.jpg
    snapshot_126.jpg snapshot_187.jpg snapshot_247.jpg snapshot_307.jpg snapshot_368.jpg snapshot_68.jpg
    snapshot_127.jpg snapshot_188.jpg snapshot_248.jpg snapshot_308.jpg snapshot_369.jpg snapshot_69.jpg
    snapshot_128.jpg snapshot_189.jpg snapshot_249.jpg snapshot_309.jpg snapshot_37.jpg  snapshot_7.jpg
    snapshot_129.jpg snapshot_19.jpg  snapshot_25.jpg  snapshot_31.jpg  snapshot_370.jpg snapshot_70.jpg
    snapshot_13.jpg  snapshot_190.jpg snapshot_250.jpg snapshot_310.jpg snapshot_371.jpg snapshot_71.jpg
    snapshot_130.jpg snapshot_191.jpg snapshot_251.jpg snapshot_311.jpg snapshot_372.jpg snapshot_72.jpg
    snapshot_131.jpg snapshot_192.jpg snapshot_252.jpg snapshot_312.jpg snapshot_373.jpg snapshot_73.jpg
    snapshot_132.jpg snapshot_193.jpg snapshot_253.jpg snapshot_313.jpg snapshot_374.jpg snapshot_74.jpg
    snapshot_133.jpg snapshot_194.jpg snapshot_254.jpg snapshot_314.jpg snapshot_375.jpg snapshot_75.jpg
    snapshot_134.jpg snapshot_195.jpg snapshot_255.jpg snapshot_315.jpg snapshot_376.jpg snapshot_76.jpg
    snapshot_135.jpg snapshot_196.jpg snapshot_256.jpg snapshot_316.jpg snapshot_377.jpg snapshot_77.jpg
    snapshot_136.jpg snapshot_197.jpg snapshot_257.jpg snapshot_317.jpg snapshot_378.jpg snapshot_78.jpg
    snapshot_137.jpg snapshot_198.jpg snapshot_258.jpg snapshot_318.jpg snapshot_379.jpg snapshot_79.jpg
    snapshot_138.jpg snapshot_199.jpg snapshot_259.jpg snapshot_319.jpg snapshot_38.jpg  snapshot_8.jpg
    snapshot_139.jpg snapshot_2.jpg   snapshot_26.jpg  snapshot_32.jpg  snapshot_380.jpg snapshot_80.jpg
    snapshot_14.jpg  snapshot_20.jpg  snapshot_260.jpg snapshot_320.jpg snapshot_381.jpg snapshot_81.jpg
    snapshot_140.jpg snapshot_200.jpg snapshot_261.jpg snapshot_321.jpg snapshot_382.jpg snapshot_82.jpg
    snapshot_141.jpg snapshot_201.jpg snapshot_262.jpg snapshot_322.jpg snapshot_383.jpg snapshot_83.jpg
    snapshot_142.jpg snapshot_202.jpg snapshot_263.jpg snapshot_323.jpg snapshot_384.jpg snapshot_84.jpg
    snapshot_143.jpg snapshot_203.jpg snapshot_264.jpg snapshot_324.jpg snapshot_385.jpg snapshot_85.jpg
    snapshot_144.jpg snapshot_204.jpg snapshot_265.jpg snapshot_325.jpg snapshot_386.jpg snapshot_86.jpg
    snapshot_145.jpg snapshot_205.jpg snapshot_266.jpg snapshot_326.jpg snapshot_387.jpg snapshot_87.jpg
    snapshot_146.jpg snapshot_206.jpg snapshot_267.jpg snapshot_327.jpg snapshot_388.jpg snapshot_88.jpg
    snapshot_147.jpg snapshot_207.jpg snapshot_268.jpg snapshot_328.jpg snapshot_389.jpg snapshot_89.jpg
    snapshot_148.jpg snapshot_208.jpg snapshot_269.jpg snapshot_329.jpg snapshot_39.jpg  snapshot_9.jpg
    snapshot_149.jpg snapshot_209.jpg snapshot_27.jpg  snapshot_33.jpg  snapshot_390.jpg snapshot_90.jpg
    snapshot_15.jpg  snapshot_21.jpg  snapshot_270.jpg snapshot_330.jpg snapshot_391.jpg snapshot_91.jpg
    snapshot_150.jpg snapshot_210.jpg snapshot_271.jpg snapshot_331.jpg snapshot_392.jpg snapshot_92.jpg
    snapshot_151.jpg snapshot_211.jpg snapshot_272.jpg snapshot_332.jpg snapshot_393.jpg snapshot_93.jpg
    snapshot_152.jpg snapshot_212.jpg snapshot_273.jpg snapshot_333.jpg snapshot_394.jpg snapshot_94.jpg
    snapshot_153.jpg snapshot_213.jpg snapshot_274.jpg snapshot_334.jpg snapshot_395.jpg snapshot_95.jpg
    snapshot_154.jpg snapshot_214.jpg snapshot_275.jpg snapshot_335.jpg snapshot_396.jpg snapshot_96.jpg
    snapshot_155.jpg snapshot_215.jpg snapshot_276.jpg snapshot_336.jpg snapshot_397.jpg snapshot_97.jpg
    snapshot_156.jpg snapshot_216.jpg snapshot_277.jpg snapshot_337.jpg snapshot_398.jpg snapshot_98.jpg
    snapshot_157.jpg snapshot_217.jpg snapshot_278.jpg snapshot_338.jpg snapshot_399.jpg snapshot_99.jpg
    snapshot_158.jpg snapshot_218.jpg snapshot_279.jpg snapshot_339.jpg snapshot_4.jpg


### ノック 84 : 画像内のどこに人がいるのか検出しよう

HOG抽出量により人の顔を検出します。


```python
import cv2

hog = cv2.HOGDescriptor()

hog.setSVCMdetector(cv2.HOGDescriptor_getDefaultPeopleDetector())
hogParams = {
  'winStride'
}
```

### ノック 85 : 画像内の人の顔を検出してみよう


```python

```

### ノック 86 : 画像内の人がどこに顔を向けているのかを検出してみよう


```python

```

### ノック 87 : 検出した情報を統合し、タイムラプスを作ってみよう


```python

```

### ノック 88 : 全体像をグラフにして可視化してみよう


```python

```

### ノック 89 : 人通りの変化をグラフで確認しよう


```python

```

### ノック 90 : 移動平均を計算することでノイズの影響を除去しよう


```python

```

## 関連記事
- [第1章 ウェブからの注文数を分析する10本ノック](/ml/data100/01/)
- [第2章 小売店のデータでデータ加工を行う10本ノック](/ml/data100/02/)
- [第3章 顧客の全体像を把握する10本ノック](/ml/data100/03/)
- [第4章 顧客の行動を予測する10本ノック](/ml/data100/04/)
- [第5章 顧客の退会を予測する10本ノック](/ml/data100/05/)
- [第6章 物流の最適ルートをコンサルティングする10本ノック](/ml/data100/06/)
- [第7章 ロジスティクスネットワークの最適設計を行う10本ノック](/ml/data100/07/)
- [第8章 数値シミュレーションで消費者行動を予測する10本ノック](/ml/data100/08/)
- [第9章 潜在顧客を把握するための画像認識10本ノック](/ml/data100/09/)
- [第10章 アンケート分析を行うための自然言語処理10本ノック](/ml/data100/10/)
