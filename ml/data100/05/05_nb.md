
## 第5章 顧客の退会を予測する10本ノック

この記事は[「Python実践データ分析100本ノック」](https://www.amazon.co.jp/dp/B07ZSGSN9S/ref=dp-kindle-redirect?_encoding=UTF8&btkr=1)の演習を実際にやってみたという内容になっています。今まで自己流でやってきましたが、一度他の方々がどのような考え方やコーディングをしているのか勉強してみようと思ってやってみました。本書は実際の業務に活用する上でとても参考になる内容だと思っています。データ分析に関わる仕事をしたい方にお勧めしたいです。

本演習で利用しているデータは本サイトからは利用できません。ぜひとも「Python実践データ分析１００本ノック」を購入し、本に沿ってダウンロードして自分の手でコーディングしてみてください。（私は決して回し者ではないので安心してください笑）

前章（4章）では、クラスタリングと線形回帰をして見ました。今回は決定木のようです。データ分析や予測において最初に使われるのがほとんど決定木を基本とする、XGBoostやLightGBM、ランダムフォレストの元となっています。

### github
- jupyter notebook形式のファイルは[こちら](https://github.com/hiroshi0530/wa-src/blob/master/ml/data100/05/05_nb.ipynb)

### google colaboratory
- google colaboratory で実行する場合は[こちら](https://colab.research.google.com/github/hiroshi0530/wa-src/blob/master/ml/data100/05/05_nb.ipynb)

### 筆者の環境


```python
!sw_vers
```

    ProductName:	Mac OS X
    ProductVersion:	10.14.6
    BuildVersion:	18G6020



```python
!python -V
```

    Python 3.7.3


基本的なライブラリをインポートしそのバージョンを確認しておきます。


```python
%matplotlib inline
%config InlineBackend.figure_format = 'svg'

import matplotlib
import matplotlib.pyplot as plt
import scipy
import numpy as np
import pandas as pd

print('matplotlib version :', matplotlib.__version__)
print('scipy version :', scipy.__version__)
print('numpy version :', np.__version__)
print('pandas version :', pd.__version__)
```

    matplotlib version : 3.0.3
    scipy version : 1.4.1
    numpy version : 1.16.2
    pandas version : 1.0.3


## 解答

### ノック : 41 データを読み込んで利用で他を整形しよう


```python
customer = pd.read_csv('customer_join.csv')
uselog_months = pd.read_csv('use_log_months.csv')
```


```python
customer.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_id</th>
      <th>name</th>
      <th>class</th>
      <th>gender</th>
      <th>start_date</th>
      <th>end_date</th>
      <th>campaign_id</th>
      <th>is_deleted</th>
      <th>class_name</th>
      <th>price</th>
      <th>campaign_name</th>
      <th>mean</th>
      <th>median</th>
      <th>max</th>
      <th>min</th>
      <th>routine_flg</th>
      <th>calc_date</th>
      <th>membership_period</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>OA832399</td>
      <td>XXXX</td>
      <td>C01</td>
      <td>F</td>
      <td>2015-05-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>0</td>
      <td>オールタイム</td>
      <td>10500</td>
      <td>通常</td>
      <td>4.833333</td>
      <td>5.0</td>
      <td>8</td>
      <td>2</td>
      <td>1</td>
      <td>2019-04-30</td>
      <td>47</td>
    </tr>
    <tr>
      <th>1</th>
      <td>PL270116</td>
      <td>XXXXX</td>
      <td>C01</td>
      <td>M</td>
      <td>2015-05-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>0</td>
      <td>オールタイム</td>
      <td>10500</td>
      <td>通常</td>
      <td>5.083333</td>
      <td>5.0</td>
      <td>7</td>
      <td>3</td>
      <td>1</td>
      <td>2019-04-30</td>
      <td>47</td>
    </tr>
    <tr>
      <th>2</th>
      <td>OA974876</td>
      <td>XXXXX</td>
      <td>C01</td>
      <td>M</td>
      <td>2015-05-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>0</td>
      <td>オールタイム</td>
      <td>10500</td>
      <td>通常</td>
      <td>4.583333</td>
      <td>5.0</td>
      <td>6</td>
      <td>3</td>
      <td>1</td>
      <td>2019-04-30</td>
      <td>47</td>
    </tr>
    <tr>
      <th>3</th>
      <td>HD024127</td>
      <td>XXXXX</td>
      <td>C01</td>
      <td>F</td>
      <td>2015-05-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>0</td>
      <td>オールタイム</td>
      <td>10500</td>
      <td>通常</td>
      <td>4.833333</td>
      <td>4.5</td>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>2019-04-30</td>
      <td>47</td>
    </tr>
    <tr>
      <th>4</th>
      <td>HD661448</td>
      <td>XXXXX</td>
      <td>C03</td>
      <td>F</td>
      <td>2015-05-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>0</td>
      <td>ナイト</td>
      <td>6000</td>
      <td>通常</td>
      <td>3.916667</td>
      <td>4.0</td>
      <td>6</td>
      <td>1</td>
      <td>1</td>
      <td>2019-04-30</td>
      <td>47</td>
    </tr>
  </tbody>
</table>
</div>




```python
uselog_months.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>年月</th>
      <th>customer_id</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>201804</td>
      <td>AS002855</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>201804</td>
      <td>AS009013</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>201804</td>
      <td>AS009373</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>201804</td>
      <td>AS015315</td>
      <td>6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>201804</td>
      <td>AS015739</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>




```python
year_months = list(uselog_months['年月'].unique())
uselog = pd.DataFrame()

for i in range(1, len(year_months)):
  tmp = uselog_months.loc[uselog_months['年月'] == year_months[i]]
  tmp.rename(columns={'count': 'count_0'}, inplace=True)
  tmp_before = uselog_months.loc[uselog_months['年月'] == year_months[i-1]]
  del tmp_before['年月']
  tmp_before.rename(columns={'count': 'count_1'}, inplace=True)
  tmp = pd.merge(tmp, tmp_before, on='customer_id', how='left')
  uselog = pd.concat([uselog, tmp], ignore_index=True)
```

    /Users/hiroshi/anaconda3/lib/python3.7/site-packages/pandas/core/frame.py:4133: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      errors=errors,



```python
uselog.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>年月</th>
      <th>customer_id</th>
      <th>count_0</th>
      <th>count_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>201805</td>
      <td>AS002855</td>
      <td>5</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>201805</td>
      <td>AS009373</td>
      <td>4</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>201805</td>
      <td>AS015233</td>
      <td>7</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>201805</td>
      <td>AS015315</td>
      <td>3</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>201805</td>
      <td>AS015739</td>
      <td>5</td>
      <td>7.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
uselog.shape
```




    (33851, 4)



### ノック : 42 大会前日の大会顧客データを作成しよう


```python
from dateutil.relativedelta import relativedelta
exit_customer = customer.loc[customer['is_deleted'] == 1]

exit_customer.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_id</th>
      <th>name</th>
      <th>class</th>
      <th>gender</th>
      <th>start_date</th>
      <th>end_date</th>
      <th>campaign_id</th>
      <th>is_deleted</th>
      <th>class_name</th>
      <th>price</th>
      <th>campaign_name</th>
      <th>mean</th>
      <th>median</th>
      <th>max</th>
      <th>min</th>
      <th>routine_flg</th>
      <th>calc_date</th>
      <th>membership_period</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>708</th>
      <td>TS511179</td>
      <td>XXXXXX</td>
      <td>C01</td>
      <td>F</td>
      <td>2016-05-01</td>
      <td>2018-04-30</td>
      <td>CA1</td>
      <td>1</td>
      <td>オールタイム</td>
      <td>10500</td>
      <td>通常</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>2018-04-30</td>
      <td>23</td>
    </tr>
    <tr>
      <th>729</th>
      <td>TS443736</td>
      <td>XXXX</td>
      <td>C02</td>
      <td>M</td>
      <td>2016-05-01</td>
      <td>2018-04-30</td>
      <td>CA1</td>
      <td>1</td>
      <td>デイタイム</td>
      <td>7500</td>
      <td>通常</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>2018-04-30</td>
      <td>23</td>
    </tr>
    <tr>
      <th>730</th>
      <td>HD542886</td>
      <td>XX</td>
      <td>C01</td>
      <td>M</td>
      <td>2016-05-01</td>
      <td>2018-04-30</td>
      <td>CA1</td>
      <td>1</td>
      <td>オールタイム</td>
      <td>10500</td>
      <td>通常</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>2018-04-30</td>
      <td>23</td>
    </tr>
    <tr>
      <th>770</th>
      <td>HD597545</td>
      <td>XXXXX</td>
      <td>C03</td>
      <td>F</td>
      <td>2016-06-01</td>
      <td>2018-05-31</td>
      <td>CA1</td>
      <td>1</td>
      <td>ナイト</td>
      <td>6000</td>
      <td>通常</td>
      <td>3.5</td>
      <td>3.5</td>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>2018-05-31</td>
      <td>23</td>
    </tr>
    <tr>
      <th>785</th>
      <td>HI749296</td>
      <td>XXXXX</td>
      <td>C01</td>
      <td>M</td>
      <td>2016-06-01</td>
      <td>2018-05-31</td>
      <td>CA1</td>
      <td>1</td>
      <td>オールタイム</td>
      <td>10500</td>
      <td>通常</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>2018-05-31</td>
      <td>23</td>
    </tr>
  </tbody>
</table>
</div>




```python
exit_customer['exit_date'] = None
exit_customer['end_date'] = pd.to_datetime(exit_customer['end_date'])

for i in range(len(exit_customer)):
  exit_customer['exit_date'].iloc[i] = exit_customer['end_date'].iloc[i] - relativedelta(months=1)

exit_customer['年月'] = exit_customer['exit_date'].dt.strftime('%Y%m')
uselog['年月'] = uselog['年月'] .astype(str)
exit_uselog = pd.merge(uselog, exit_customer, on=['customer_id', '年月'], how='left')
```

    /Users/hiroshi/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:1: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      """Entry point for launching an IPython kernel.
    /Users/hiroshi/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:2: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      
    /Users/hiroshi/anaconda3/lib/python3.7/site-packages/pandas/core/indexing.py:671: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      self._setitem_with_indexer(indexer, value)
    /Users/hiroshi/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:5: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      """
    /Users/hiroshi/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:7: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      import sys



```python
len(uselog)
```




    33851




```python
exit_uselog.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>年月</th>
      <th>customer_id</th>
      <th>count_0</th>
      <th>count_1</th>
      <th>name</th>
      <th>class</th>
      <th>gender</th>
      <th>start_date</th>
      <th>end_date</th>
      <th>campaign_id</th>
      <th>...</th>
      <th>price</th>
      <th>campaign_name</th>
      <th>mean</th>
      <th>median</th>
      <th>max</th>
      <th>min</th>
      <th>routine_flg</th>
      <th>calc_date</th>
      <th>membership_period</th>
      <th>exit_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>201805</td>
      <td>AS002855</td>
      <td>5</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>201805</td>
      <td>AS009373</td>
      <td>4</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>201805</td>
      <td>AS015233</td>
      <td>7</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>201805</td>
      <td>AS015315</td>
      <td>3</td>
      <td>6.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>201805</td>
      <td>AS015739</td>
      <td>5</td>
      <td>7.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 22 columns</p>
</div>



### ノック : 43 継続顧客のデータを作成しよう


```python
conti_customer = customer.loc[customer['is_deleted'] == 0]
conti_uselog = pd.merge(uselog, conti_customer, on=['customer_id'], how='left')
```


```python
conti_uselog.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>年月</th>
      <th>customer_id</th>
      <th>count_0</th>
      <th>count_1</th>
      <th>name</th>
      <th>class</th>
      <th>gender</th>
      <th>start_date</th>
      <th>end_date</th>
      <th>campaign_id</th>
      <th>...</th>
      <th>class_name</th>
      <th>price</th>
      <th>campaign_name</th>
      <th>mean</th>
      <th>median</th>
      <th>max</th>
      <th>min</th>
      <th>routine_flg</th>
      <th>calc_date</th>
      <th>membership_period</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>201805</td>
      <td>AS002855</td>
      <td>5</td>
      <td>4.0</td>
      <td>XXXX</td>
      <td>C03</td>
      <td>F</td>
      <td>2016-11-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>...</td>
      <td>ナイト</td>
      <td>6000.0</td>
      <td>通常</td>
      <td>4.500000</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2019-04-30</td>
      <td>29.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>201805</td>
      <td>AS009373</td>
      <td>4</td>
      <td>3.0</td>
      <td>XX</td>
      <td>C01</td>
      <td>F</td>
      <td>2015-11-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>...</td>
      <td>オールタイム</td>
      <td>10500.0</td>
      <td>通常</td>
      <td>5.083333</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2019-04-30</td>
      <td>41.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>201805</td>
      <td>AS015233</td>
      <td>7</td>
      <td>NaN</td>
      <td>XXXXX</td>
      <td>C01</td>
      <td>M</td>
      <td>2018-05-13</td>
      <td>NaN</td>
      <td>CA2</td>
      <td>...</td>
      <td>オールタイム</td>
      <td>10500.0</td>
      <td>入会費半額</td>
      <td>7.545455</td>
      <td>7.0</td>
      <td>11.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>2019-04-30</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>201805</td>
      <td>AS015315</td>
      <td>3</td>
      <td>6.0</td>
      <td>XXXXX</td>
      <td>C01</td>
      <td>M</td>
      <td>2015-07-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>...</td>
      <td>オールタイム</td>
      <td>10500.0</td>
      <td>通常</td>
      <td>4.833333</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2019-04-30</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>201805</td>
      <td>AS015739</td>
      <td>5</td>
      <td>7.0</td>
      <td>XXXXX</td>
      <td>C03</td>
      <td>M</td>
      <td>2017-06-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>...</td>
      <td>ナイト</td>
      <td>6000.0</td>
      <td>通常</td>
      <td>5.583333</td>
      <td>5.5</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>2019-04-30</td>
      <td>22.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div>




```python
conti_uselog = conti_uselog
```


```python
conti_uselog.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>年月</th>
      <th>customer_id</th>
      <th>count_0</th>
      <th>count_1</th>
      <th>name</th>
      <th>class</th>
      <th>gender</th>
      <th>start_date</th>
      <th>end_date</th>
      <th>campaign_id</th>
      <th>...</th>
      <th>class_name</th>
      <th>price</th>
      <th>campaign_name</th>
      <th>mean</th>
      <th>median</th>
      <th>max</th>
      <th>min</th>
      <th>routine_flg</th>
      <th>calc_date</th>
      <th>membership_period</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>201805</td>
      <td>AS002855</td>
      <td>5</td>
      <td>4.0</td>
      <td>XXXX</td>
      <td>C03</td>
      <td>F</td>
      <td>2016-11-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>...</td>
      <td>ナイト</td>
      <td>6000.0</td>
      <td>通常</td>
      <td>4.500000</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2019-04-30</td>
      <td>29.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>201805</td>
      <td>AS009373</td>
      <td>4</td>
      <td>3.0</td>
      <td>XX</td>
      <td>C01</td>
      <td>F</td>
      <td>2015-11-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>...</td>
      <td>オールタイム</td>
      <td>10500.0</td>
      <td>通常</td>
      <td>5.083333</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2019-04-30</td>
      <td>41.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>201805</td>
      <td>AS015233</td>
      <td>7</td>
      <td>NaN</td>
      <td>XXXXX</td>
      <td>C01</td>
      <td>M</td>
      <td>2018-05-13</td>
      <td>NaN</td>
      <td>CA2</td>
      <td>...</td>
      <td>オールタイム</td>
      <td>10500.0</td>
      <td>入会費半額</td>
      <td>7.545455</td>
      <td>7.0</td>
      <td>11.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>2019-04-30</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>201805</td>
      <td>AS015315</td>
      <td>3</td>
      <td>6.0</td>
      <td>XXXXX</td>
      <td>C01</td>
      <td>M</td>
      <td>2015-07-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>...</td>
      <td>オールタイム</td>
      <td>10500.0</td>
      <td>通常</td>
      <td>4.833333</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2019-04-30</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>201805</td>
      <td>AS015739</td>
      <td>5</td>
      <td>7.0</td>
      <td>XXXXX</td>
      <td>C03</td>
      <td>M</td>
      <td>2017-06-01</td>
      <td>NaN</td>
      <td>CA1</td>
      <td>...</td>
      <td>ナイト</td>
      <td>6000.0</td>
      <td>通常</td>
      <td>5.583333</td>
      <td>5.5</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>2019-04-30</td>
      <td>22.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div>



### ノック : 44 予測する月の在籍期間を作成しよう


```python
for i in range(5):
  print(i)
```

    0
    1
    2
    3
    4


### ノック : 45 欠損値を除去しよう


```python

```

### ノック : 46 文字列型の変数を処理できるように整形しよう


```python

```

### ノック : 47 決定木を用いて大会予測モデルを作成してみよう


```python

```

### ノック : 48 予測モデルの評価を行い、モデルのチューニングをしてみよう


```python

```

### ノック : 49 モデルに寄与している変数を確認しよう


```python

```

### ノック : 50 顧客の退会を予測しよう


```python

```

## 関連記事
- [第1章 ウェブからの注文数を分析する10本ノック](/ml/data100/01/)
- [第2章 小売店のデータでデータ加工を行う10本ノック](/ml/data100/02/)
- [第3章 顧客の全体像を把握する10本ノック](/ml/data100/03/)
- [第4章 顧客の行動を予測する10本ノック](/ml/data100/04/)
- [第5章 顧客の退会を予測する10本ノック](/ml/data100/05/)
- [第6章 物流の最適ルートをコンサルティングする10本ノック](/ml/data100/06/)
- [第7章 ロジスティクスネットワークの最適設計を行う10本ノック](/ml/data100/07/)
- [第8章 数値シミュレーションで消費者行動を予測する10本ノック](/ml/data100/08/)
- [第9章 潜在顧客を把握するための画像認識10本ノック](/ml/data100/09/)
- [第10章 アンケート分析を行うための自然言語処理10本ノック](/ml/data100/10/)
